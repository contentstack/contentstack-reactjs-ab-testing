{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar ACTIVATE_EVENT_KEY = 'campaign_activated';\nvar CUSTOM_ATTRIBUTE_FEATURE_TYPE = 'custom';\nvar BOT_FILTERING_KEY = '$opt_bot_filtering';\n/**\n * Given an array of batchable Decision or ConversionEvent events it returns\n * a single EventV1 with proper batching\n *\n * @param {ProcessableEvents[]} events\n * @returns {EventV1}\n */\n\nfunction makeBatchedEventV1(events) {\n  var visitors = [];\n  var data = events[0];\n  events.forEach(function (event) {\n    if (event.type === 'conversion' || event.type === 'impression') {\n      var visitor = makeVisitor(event);\n\n      if (event.type === 'impression') {\n        visitor.snapshots.push(makeDecisionSnapshot(event));\n      } else if (event.type === 'conversion') {\n        visitor.snapshots.push(makeConversionSnapshot(event));\n      }\n\n      visitors.push(visitor);\n    }\n  });\n  return {\n    client_name: data.context.clientName,\n    client_version: data.context.clientVersion,\n    account_id: data.context.accountId,\n    project_id: data.context.projectId,\n    revision: data.context.revision,\n    anonymize_ip: data.context.anonymizeIP,\n    enrich_decisions: true,\n    visitors: visitors\n  };\n}\n\nexports.makeBatchedEventV1 = makeBatchedEventV1;\n\nfunction makeConversionSnapshot(conversion) {\n  var tags = __assign({}, conversion.tags);\n\n  delete tags['revenue'];\n  delete tags['value'];\n  var event = {\n    entity_id: conversion.event.id,\n    key: conversion.event.key,\n    timestamp: conversion.timestamp,\n    uuid: conversion.uuid\n  };\n\n  if (conversion.tags) {\n    event.tags = conversion.tags;\n  }\n\n  if (conversion.value != null) {\n    event.value = conversion.value;\n  }\n\n  if (conversion.revenue != null) {\n    event.revenue = conversion.revenue;\n  }\n\n  return {\n    events: [event]\n  };\n}\n\nfunction makeDecisionSnapshot(event) {\n  var layer = event.layer,\n      experiment = event.experiment,\n      variation = event.variation;\n  var layerId = layer ? layer.id : null;\n  var experimentId = experiment ? experiment.id : null;\n  var variationId = variation ? variation.id : null;\n  return {\n    decisions: [{\n      campaign_id: layerId,\n      experiment_id: experimentId,\n      variation_id: variationId\n    }],\n    events: [{\n      entity_id: layerId,\n      timestamp: event.timestamp,\n      key: ACTIVATE_EVENT_KEY,\n      uuid: event.uuid\n    }]\n  };\n}\n\nfunction makeVisitor(data) {\n  var visitor = {\n    snapshots: [],\n    visitor_id: data.user.id,\n    attributes: []\n  };\n  data.user.attributes.forEach(function (attr) {\n    visitor.attributes.push({\n      entity_id: attr.entityId,\n      key: attr.key,\n      type: 'custom',\n      value: attr.value\n    });\n  });\n\n  if (typeof data.context.botFiltering === 'boolean') {\n    visitor.attributes.push({\n      entity_id: BOT_FILTERING_KEY,\n      key: BOT_FILTERING_KEY,\n      type: CUSTOM_ATTRIBUTE_FEATURE_TYPE,\n      value: data.context.botFiltering\n    });\n  }\n\n  return visitor;\n}\n/**\n * Event for usage with v1 logtier\n *\n * @export\n * @interface EventBuilderV1\n */\n\n\nfunction buildImpressionEventV1(data) {\n  var visitor = makeVisitor(data);\n  visitor.snapshots.push(makeDecisionSnapshot(data));\n  return {\n    client_name: data.context.clientName,\n    client_version: data.context.clientVersion,\n    account_id: data.context.accountId,\n    project_id: data.context.projectId,\n    revision: data.context.revision,\n    anonymize_ip: data.context.anonymizeIP,\n    enrich_decisions: true,\n    visitors: [visitor]\n  };\n}\n\nexports.buildImpressionEventV1 = buildImpressionEventV1;\n\nfunction buildConversionEventV1(data) {\n  var visitor = makeVisitor(data);\n  visitor.snapshots.push(makeConversionSnapshot(data));\n  return {\n    client_name: data.context.clientName,\n    client_version: data.context.clientVersion,\n    account_id: data.context.accountId,\n    project_id: data.context.projectId,\n    revision: data.context.revision,\n    anonymize_ip: data.context.anonymizeIP,\n    enrich_decisions: true,\n    visitors: [visitor]\n  };\n}\n\nexports.buildConversionEventV1 = buildConversionEventV1;","map":{"version":3,"sources":["/home/abhishek/Music/contentstack-reactjs-ab-testing/node_modules/@optimizely/js-sdk-event-processor/lib/v1/buildEventV1.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","defineProperty","exports","value","ACTIVATE_EVENT_KEY","CUSTOM_ATTRIBUTE_FEATURE_TYPE","BOT_FILTERING_KEY","makeBatchedEventV1","events","visitors","data","forEach","event","type","visitor","makeVisitor","snapshots","push","makeDecisionSnapshot","makeConversionSnapshot","client_name","context","clientName","client_version","clientVersion","account_id","accountId","project_id","projectId","revision","anonymize_ip","anonymizeIP","enrich_decisions","conversion","tags","entity_id","id","key","timestamp","uuid","revenue","layer","experiment","variation","layerId","experimentId","variationId","decisions","campaign_id","experiment_id","variation_id","visitor_id","user","attributes","attr","entityId","botFiltering","buildImpressionEventV1","buildConversionEventV1"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ACTIVATE_EVENT_KEY = 'campaign_activated';\nvar CUSTOM_ATTRIBUTE_FEATURE_TYPE = 'custom';\nvar BOT_FILTERING_KEY = '$opt_bot_filtering';\n/**\n * Given an array of batchable Decision or ConversionEvent events it returns\n * a single EventV1 with proper batching\n *\n * @param {ProcessableEvents[]} events\n * @returns {EventV1}\n */\nfunction makeBatchedEventV1(events) {\n    var visitors = [];\n    var data = events[0];\n    events.forEach(function (event) {\n        if (event.type === 'conversion' || event.type === 'impression') {\n            var visitor = makeVisitor(event);\n            if (event.type === 'impression') {\n                visitor.snapshots.push(makeDecisionSnapshot(event));\n            }\n            else if (event.type === 'conversion') {\n                visitor.snapshots.push(makeConversionSnapshot(event));\n            }\n            visitors.push(visitor);\n        }\n    });\n    return {\n        client_name: data.context.clientName,\n        client_version: data.context.clientVersion,\n        account_id: data.context.accountId,\n        project_id: data.context.projectId,\n        revision: data.context.revision,\n        anonymize_ip: data.context.anonymizeIP,\n        enrich_decisions: true,\n        visitors: visitors,\n    };\n}\nexports.makeBatchedEventV1 = makeBatchedEventV1;\nfunction makeConversionSnapshot(conversion) {\n    var tags = __assign({}, conversion.tags);\n    delete tags['revenue'];\n    delete tags['value'];\n    var event = {\n        entity_id: conversion.event.id,\n        key: conversion.event.key,\n        timestamp: conversion.timestamp,\n        uuid: conversion.uuid,\n    };\n    if (conversion.tags) {\n        event.tags = conversion.tags;\n    }\n    if (conversion.value != null) {\n        event.value = conversion.value;\n    }\n    if (conversion.revenue != null) {\n        event.revenue = conversion.revenue;\n    }\n    return {\n        events: [event],\n    };\n}\nfunction makeDecisionSnapshot(event) {\n    var layer = event.layer, experiment = event.experiment, variation = event.variation;\n    var layerId = layer ? layer.id : null;\n    var experimentId = experiment ? experiment.id : null;\n    var variationId = variation ? variation.id : null;\n    return {\n        decisions: [\n            {\n                campaign_id: layerId,\n                experiment_id: experimentId,\n                variation_id: variationId,\n            },\n        ],\n        events: [\n            {\n                entity_id: layerId,\n                timestamp: event.timestamp,\n                key: ACTIVATE_EVENT_KEY,\n                uuid: event.uuid,\n            },\n        ],\n    };\n}\nfunction makeVisitor(data) {\n    var visitor = {\n        snapshots: [],\n        visitor_id: data.user.id,\n        attributes: [],\n    };\n    data.user.attributes.forEach(function (attr) {\n        visitor.attributes.push({\n            entity_id: attr.entityId,\n            key: attr.key,\n            type: 'custom',\n            value: attr.value,\n        });\n    });\n    if (typeof data.context.botFiltering === 'boolean') {\n        visitor.attributes.push({\n            entity_id: BOT_FILTERING_KEY,\n            key: BOT_FILTERING_KEY,\n            type: CUSTOM_ATTRIBUTE_FEATURE_TYPE,\n            value: data.context.botFiltering,\n        });\n    }\n    return visitor;\n}\n/**\n * Event for usage with v1 logtier\n *\n * @export\n * @interface EventBuilderV1\n */\nfunction buildImpressionEventV1(data) {\n    var visitor = makeVisitor(data);\n    visitor.snapshots.push(makeDecisionSnapshot(data));\n    return {\n        client_name: data.context.clientName,\n        client_version: data.context.clientVersion,\n        account_id: data.context.accountId,\n        project_id: data.context.projectId,\n        revision: data.context.revision,\n        anonymize_ip: data.context.anonymizeIP,\n        enrich_decisions: true,\n        visitors: [visitor],\n    };\n}\nexports.buildImpressionEventV1 = buildImpressionEventV1;\nfunction buildConversionEventV1(data) {\n    var visitor = makeVisitor(data);\n    visitor.snapshots.push(makeConversionSnapshot(data));\n    return {\n        client_name: data.context.clientName,\n        client_version: data.context.clientVersion,\n        account_id: data.context.accountId,\n        project_id: data.context.projectId,\n        revision: data.context.revision,\n        anonymize_ip: data.context.anonymizeIP,\n        enrich_decisions: true,\n        visitors: [visitor],\n    };\n}\nexports.buildConversionEventV1 = buildConversionEventV1;\n"]},"metadata":{},"sourceType":"script"}