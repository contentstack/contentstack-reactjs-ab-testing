{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\n * Copyright 2019, Optimizely\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar js_sdk_utils_1 = require(\"@optimizely/js-sdk-utils\");\n\nvar js_sdk_logging_1 = require(\"@optimizely/js-sdk-logging\");\n\nvar logger = js_sdk_logging_1.getLogger('EventProcessor');\n\nvar LocalStorageStore =\n/** @class */\nfunction () {\n  function LocalStorageStore(_a) {\n    var key = _a.key,\n        _b = _a.maxValues,\n        maxValues = _b === void 0 ? 1000 : _b;\n    this.LS_KEY = key;\n    this.maxValues = maxValues;\n  }\n\n  LocalStorageStore.prototype.get = function (key) {\n    return this.getMap()[key] || null;\n  };\n\n  LocalStorageStore.prototype.set = function (key, value) {\n    var map = this.getMap();\n    map[key] = value;\n    this.replace(map);\n  };\n\n  LocalStorageStore.prototype.remove = function (key) {\n    var map = this.getMap();\n    delete map[key];\n    this.replace(map);\n  };\n\n  LocalStorageStore.prototype.values = function () {\n    return js_sdk_utils_1.objectValues(this.getMap());\n  };\n\n  LocalStorageStore.prototype.clear = function () {\n    this.replace({});\n  };\n\n  LocalStorageStore.prototype.replace = function (map) {\n    try {\n      // This is a temporary fix to support React Native which does not have localStorage.\n      window.localStorage && localStorage.setItem(this.LS_KEY, JSON.stringify(map));\n      this.clean();\n    } catch (e) {\n      logger.error(e);\n    }\n  };\n\n  LocalStorageStore.prototype.clean = function () {\n    var map = this.getMap();\n    var keys = Object.keys(map);\n    var toRemove = keys.length - this.maxValues;\n\n    if (toRemove < 1) {\n      return;\n    }\n\n    var entries = keys.map(function (key) {\n      return {\n        key: key,\n        value: map[key]\n      };\n    });\n    entries.sort(function (a, b) {\n      return a.value.timestamp - b.value.timestamp;\n    });\n\n    for (var i = 0; i < toRemove; i++) {\n      delete map[entries[i].key];\n    }\n\n    this.replace(map);\n  };\n\n  LocalStorageStore.prototype.getMap = function () {\n    try {\n      // This is a temporary fix to support React Native which does not have localStorage.\n      var data = window.localStorage && localStorage.getItem(this.LS_KEY);\n\n      if (data) {\n        return JSON.parse(data) || {};\n      }\n    } catch (e) {\n      logger.error(e);\n    }\n\n    return {};\n  };\n\n  return LocalStorageStore;\n}();\n\nexports.LocalStorageStore = LocalStorageStore;","map":{"version":3,"sources":["/home/abhishek/Music/contentstack-reactjs-ab-testing/node_modules/@optimizely/js-sdk-event-processor/lib/pendingEventsStore.js"],"names":["Object","defineProperty","exports","value","js_sdk_utils_1","require","js_sdk_logging_1","logger","getLogger","LocalStorageStore","_a","key","_b","maxValues","LS_KEY","prototype","get","getMap","set","map","replace","remove","values","objectValues","clear","window","localStorage","setItem","JSON","stringify","clean","e","error","keys","toRemove","length","entries","sort","a","b","timestamp","i","data","getItem","parse"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Copyright 2019, Optimizely\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar js_sdk_utils_1 = require(\"@optimizely/js-sdk-utils\");\nvar js_sdk_logging_1 = require(\"@optimizely/js-sdk-logging\");\nvar logger = js_sdk_logging_1.getLogger('EventProcessor');\nvar LocalStorageStore = /** @class */ (function () {\n    function LocalStorageStore(_a) {\n        var key = _a.key, _b = _a.maxValues, maxValues = _b === void 0 ? 1000 : _b;\n        this.LS_KEY = key;\n        this.maxValues = maxValues;\n    }\n    LocalStorageStore.prototype.get = function (key) {\n        return this.getMap()[key] || null;\n    };\n    LocalStorageStore.prototype.set = function (key, value) {\n        var map = this.getMap();\n        map[key] = value;\n        this.replace(map);\n    };\n    LocalStorageStore.prototype.remove = function (key) {\n        var map = this.getMap();\n        delete map[key];\n        this.replace(map);\n    };\n    LocalStorageStore.prototype.values = function () {\n        return js_sdk_utils_1.objectValues(this.getMap());\n    };\n    LocalStorageStore.prototype.clear = function () {\n        this.replace({});\n    };\n    LocalStorageStore.prototype.replace = function (map) {\n        try {\n            // This is a temporary fix to support React Native which does not have localStorage.\n            window.localStorage && localStorage.setItem(this.LS_KEY, JSON.stringify(map));\n            this.clean();\n        }\n        catch (e) {\n            logger.error(e);\n        }\n    };\n    LocalStorageStore.prototype.clean = function () {\n        var map = this.getMap();\n        var keys = Object.keys(map);\n        var toRemove = keys.length - this.maxValues;\n        if (toRemove < 1) {\n            return;\n        }\n        var entries = keys.map(function (key) { return ({\n            key: key,\n            value: map[key]\n        }); });\n        entries.sort(function (a, b) { return a.value.timestamp - b.value.timestamp; });\n        for (var i = 0; i < toRemove; i++) {\n            delete map[entries[i].key];\n        }\n        this.replace(map);\n    };\n    LocalStorageStore.prototype.getMap = function () {\n        try {\n            // This is a temporary fix to support React Native which does not have localStorage.\n            var data = window.localStorage && localStorage.getItem(this.LS_KEY);\n            if (data) {\n                return JSON.parse(data) || {};\n            }\n        }\n        catch (e) {\n            logger.error(e);\n        }\n        return {};\n    };\n    return LocalStorageStore;\n}());\nexports.LocalStorageStore = LocalStorageStore;\n"]},"metadata":{},"sourceType":"script"}